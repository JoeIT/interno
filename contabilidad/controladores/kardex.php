<?php
session_start();
define('CLAS', "../clases");
define('SMARTY_DIR', "../smarty/");

require_once(SMARTY_DIR . 'Smarty.class.php');
include_once('../clases/responsable.php');
include_once('../clases/includes/validador.php');
include_once('../clases/activo.php');
include_once('../clases/grupo.php');

$smarty = new Smarty();
$smarty->template_dir = '../templates/';
$smarty->compile_dir = '../templates_c';

$responsable= new Responsable();
$activo= new Activo();
$grupo= new Grupo();

if(!isset($_SESSION['logeo'])){
	header("Location: ../index_logeo.php");
} 
else
 { 
	if (isset($_GET['kardex']))
	{
		$nombre_asis2=$_GET['nombre_asis2'];
		$nombre_asis=$_GET['nombre_asis'];	
		$resp_id2=$_GET['resp_id2'];//responsable
		$resp_id=$_GET['resp_id'];//asignado
		     
		if ($_GET['nombre_asis2']=='')
		{  $error['err_resp'] = "Seleccione un responsable";
			
		}
		if ($_GET['nombre_asis']=='')
		{
			$error['err_asig'] = "Seleccione un asignado";
		}
		
		 if ($_GET['radio']=='')
		{  $error['radio'] = "Seleccione una de las opciones para generar el Reporte";
	       
		}

	if (isset($error))
	{
		$smarty->assign('nombre_asis2',$nombre_asis2);	
		$smarty->assign('nombre_asis', $nombre_asis);	
		$smarty->assign('resp_id2',$resp_id2);	
		$smarty->assign('resp_id',$resp_id);	
				
		$smarty->assign('error',$error);	  			   			
		$smarty->display('rep_responsable.html');			
										
	} 
	 
	else		          
	 {	if ($_GET['radio']==1)
		{   
			 $nombre_asis2=$_GET['nombre_asis2'];
		     $nombre_asis=$_GET['nombre_asis'];	
		     $resp_id2=$_GET['resp_id2'];//responsable
		     $resp_id=$_GET['resp_id'];//asignado
		     $desgrupo=$grupo->listar_grupo();
			
		     
		     if ($resp_id2==$resp_id)    
		     { 
		     	
		     	$res_kardex=$activo->resumen_kardex($resp_id2);  
		     	$respo=$responsable->mostrar_responsable($resp_id2); 
		    	 if ($res_kardex=='')
		    	 {
		    	 		$error['err'] = "El responsable primario no es el correcto ";
		    	 		$smarty->assign('error',$error);	  			   			
						$smarty->display('rep_responsable.html');	
		    	 }
		    	 else 
		    	 {
			     	$smarty->assign('responsable', $nombre_asis2);
				    $smarty->assign('asignado', $nombre_asis);
				    $smarty->assign('cargo', $cargo);
				    $smarty->assign('respo', $respo);
				    $smarty->assign('res_kardex', $res_kardex);	        
			               
			     	$smarty->display('resumen_kardex.html');  
		    	 }
		     }
		     else 
		     {
		     	$res_kardex=$activo->resumen_kardex_personal($resp_id);  
				$respo=$responsable->mostrar_responsable($resp_id);
		     	
				/*echo "<pre>";
		    	print_r($res_kardex);
		    	echo "</pre>";
				*/
				
				$smarty->assign('responsable', $nombre_asis2);
			    $smarty->assign('asignado', $nombre_asis);
			    $smarty->assign('cargo', $cargo);
			    $smarty->assign('respo', $respo);
			    $smarty->assign('res_kardex', $res_kardex);	        
			               	
		     	$smarty->display('resumen_kardex_personal.html');  
		     }		  

		
		  
		 
			
		  
		}   
		else 
		{
			if ($_GET['radio']==2)
			{
			 $nombre_asis2=$_GET['nombre_asis2'];
		     $nombre_asis=$_GET['nombre_asis'];	
		     $resp_id2=$_GET['resp_id2'];//responsable
		     $resp_id=$_GET['resp_id'];//asignado
		     $desgrupo=$grupo->listar_grupo();    

		        if ($resp_id2==$resp_id)    
		     { 
		     	
		     	$res_kardex=$activo->resumen_kardex_especifico($resp_id2);  
		     	$respo=$responsable->mostrar_responsable($resp_id2); 
		     	
		    	 if ($res_kardex=='')
		    	 {
		    	 		$error['err'] = "El responsable primario no es el correcto ";
		    	 		$smarty->assign('error',$error);	  			   			
						$smarty->display('rep_responsable.html');	
		    	 }
		    	 else 
		    	 {  
		    	 	 $t=count($res_kardex);
		   
				$maximot=1;
				  if($t <= $maximot )
				   	     $num_paginas=1;
					  else
					  {
						 if($t > $maximot )
				     		{
						       $num=$t/$maximot;
					       	   $num_paginas=ceil($num);
								   
							}
						 
						 }
				   }
			
				$smarty->assign('maximot', $maximot);
				$smarty->assign('t', $t);
				$smarty->assign('num_paginas',$num_paginas);
				/*	 echo "<pre>";
		    	print_r($res_kardex);
		    	echo "</pre>";
					 	*/
		    	 	
		    	 	$smarty->assign('responsable', $nombre_asis2);
				    $smarty->assign('asignado', $nombre_asis);
				    $smarty->assign('cargo', $cargo);
				    $smarty->assign('respo', $respo);
				    $smarty->assign('res_kardex', $res_kardex);	        
			               
			     	 $smarty->display('activo_kardex.html'); 
		    	 }
		     else {
		    	 	$error['err_kar'] = "El kardex solo esta habilitado para los responsables primarios ";
		    	 	$smarty->assign('error',$error);	
		    	 	$smarty->display('rep_responsable.html');	
		    	 }
			
		    	 
		    	 
		     }
		     else {
				
		    	 		$error['err_kardex'] = "Seleccione en los dos campos el nombre del responsable Primario ";
		    	 		$smarty->assign('error',$error);	  			   			
						$smarty->display('rep_responsable.html');	
		     }	
		     
	  	
				
	         	}
			}
	}
		    
		    
 }	   
	
		
  



?>

























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































